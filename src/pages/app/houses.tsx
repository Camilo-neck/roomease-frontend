// Next
import Head from 'next/head'
import Image from 'next/image'
import Link from 'next/link'

// Styles
import { Inter } from 'next/font/google'
import styles from '@/styles/Home.module.css'

// Material UI
import { Button } from '@mui/material'

// Redux
import { useSelector, useDispatch } from 'react-redux'
import { selectUser } from '@/redux/slices/user.slice'
import { logoutUser } from '@/controllers/auth.controllers'
import { useEffect } from 'react'
import { getCookie } from '@/lib/cookie'
import jwt from 'jsonwebtoken'
import { fetchUserInfo } from '@/redux/thunks/user.thunk'
import { useRouter } from 'next/navigation'

const inter = Inter({ subsets: ['latin'] })

const Houses = () => {
  const user = useSelector(selectUser)
  const dispatch = useDispatch();
  const router = useRouter();

  useEffect(() => {
    // Fetch the user
    async function f() {
      const cookie = getCookie('auth-token')
      if (cookie) {
        const decoded: any = jwt.decode(cookie)
        if (decoded) {
          const { _id } = decoded
          dispatch(fetchUserInfo(_id, cookie))
        }
      }
    }
    f()
  }, [])

  return (
    <>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className={styles.main}>
        <div className={styles.description}>
          {!user.name ? (
            <>
              <Link href='/auth/login'>
                <Button
                  variant='outlined'
                  className='text-[#D0BCFF] hover:bg-[#D0BCFF]/5 focus:bg-[#D0BCFF]/10 rounded-full border focus:border-[#D0BCFF] hover:border-[#938F99] border-[#938F99]'>
                  Login
                </Button>
              </Link>
              <Link href='/auth/register'>
                <Button
                  variant='outlined'
                  className='text-[#CDE5FF] hover:bg-[#CDE5FF]/5 focus:bg-[#CDE5FF]/10 rounded-full border focus:border-[#CDE5FF] hover:border-[#6F797A] border-[#6F797A]'>
                  Register
                </Button>
              </Link>
            </>
          ) :
            <>
              <p>
                Nombre: <span className={styles.code}>{user.name}</span>
              </p>
              <p>
                Email: <span className={styles.code}>{user.email}</span>
              </p>
              <Button
                variant='outlined'
                onClick={() => {dispatch(logoutUser());;router.push('/');}}
                className='text-error-30 hover:bg-error-30/5 focus:bg-error-30/10 rounded-full border focus:border-neutral-30 hover:border-error-20 border-neutral-30'>
                Logout
              </Button>
            </>
          }
          <div>
          </div>
        </div>

        <div className={styles.center}>
          <Image
            src="/auth-coliving-people.png"
            alt="Next.js Logo"
            width={420}
            height={100}
            priority
          />
          <div className={styles.thirteen}>
            <p className='text-2xl font-bold font-mono'>RE</p>
          </div>
        </div>
        <div className={styles.center}>
          <p className='text-xl font-semibold font-mono'>
            Lo mejor para convivir con tus Roomies y llevar una vida m√°s sana y feliz.
          </p>
        </div>
      </main>
    </>
  )
};

export default Houses;